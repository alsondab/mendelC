# ‚è∞ Configuration du Syst√®me de Promotions Automatiques

## üîß **Configuration du Cron Job**

Votre syst√®me de promotions temporaires n√©cessite une v√©rification automatique r√©guli√®re pour expirer les promotions et ajuster les tags.

### **Option 1 : Vercel Cron Jobs (Recommand√©)**

Si vous utilisez Vercel, ajoutez ceci √† votre `vercel.json` :

```json
{
  "crons": [
    {
      "path": "/api/cron/check-promotions",
      "schedule": "0 */6 * * *"
    }
  ]
}
```

**Explication du planning :**
- `0 */6 * * *` = Toutes les 6 heures (00:00, 06:00, 12:00, 18:00)
- `0 0 * * *` = Une fois par jour √† minuit
- `0 */2 * * *` = Toutes les 2 heures

### **Option 2 : Cron Job Externe**

Utilisez un service comme **cron-job.org** ou **EasyCron** :

1. **URL √† appeler :** `https://votresite.com/api/cron/check-promotions`
2. **M√©thode :** GET
3. **Headers :** `Authorization: Bearer VOTRE_SECRET_CRON`
4. **Fr√©quence :** Toutes les 6 heures

### **Option 3 : Test Manuel**

Pour tester le syst√®me manuellement :

```bash
# Test via cURL
curl -X POST https://votresite.com/api/cron/check-promotions

# Ou via l'interface admin
# Allez sur /admin/promotions et cliquez sur "Actualiser les statistiques"
```

---

## üîê **Configuration de la S√©curit√©**

### **1. Variable d'environnement**

Ajoutez dans votre `.env.local` :

```bash
CRON_SECRET=votre_secret_tres_long_et_complexe_ici
```

### **2. Exemple de secret s√©curis√©**

```bash
CRON_SECRET=cron_promotions_2024_xyz789_secure_hash_abc123
```

**‚ö†Ô∏è Important :** Ne partagez JAMAIS ce secret et changez-le r√©guli√®rement !

---

## üìä **Monitoring et Logs**

### **Logs automatiques**

Le syst√®me g√©n√®re automatiquement des logs d√©taill√©s :

```
üïê V√©rification automatique des promotions expir√©es...
üîç 3 promotions expir√©es trouv√©es
‚úÖ Promotion expir√©e pour iPhone 15, nouveaux tags: best-seller, featured
‚úÖ Promotion expir√©e pour Samsung Galaxy, nouveaux tags: new-arrival
‚úÖ Promotion expir√©e pour MacBook, nouveaux tags: premium
‚úÖ 3 promotions mises √† jour
```

### **V√©rification des performances**

Acc√©dez √† `/admin/promotions` pour voir :
- üìà **Promotions actives** en temps r√©el
- ‚ö†Ô∏è **Promotions expir√©es** √† traiter
- üìä **Total des promotions** g√©r√©es

---

## üöÄ **D√©ploiement en Production**

### **1. Vercel (Recommand√©)**

```bash
# D√©ployez avec la configuration cron
vercel --prod

# V√©rifiez que le cron est actif
vercel cron list
```

### **2. Autres plateformes**

- **Netlify :** Utilisez des fonctions serverless avec des triggers externes
- **Railway :** Configurez des t√¢ches cron dans le dashboard
- **DigitalOcean :** Utilisez des droplets avec des cron jobs syst√®me

---

## üîç **D√©pannage**

### **Probl√®me : Les promotions n'expirent pas**

**Solutions :**
1. ‚úÖ V√©rifiez que le cron job est configur√©
2. ‚úÖ V√©rifiez les logs dans `/admin/promotions`
3. ‚úÖ Testez manuellement via l'API
4. ‚úÖ V√©rifiez la variable `CRON_SECRET`

### **Probl√®me : Erreur 401 (Non autoris√©)**

**Solutions :**
1. ‚úÖ V√©rifiez que `CRON_SECRET` est d√©fini
2. ‚úÖ V√©rifiez que le header `Authorization` est correct
3. ‚úÖ Red√©ployez apr√®s modification des variables d'environnement

### **Probl√®me : Les tags ne changent pas**

**Solutions :**
1. ‚úÖ V√©rifiez que les produits ont des `promotionExpiryDate`
2. ‚úÖ V√©rifiez que `isPromotionActive` est `true`
3. ‚úÖ V√©rifiez les logs pour les erreurs

---

## üìà **Optimisation des Performances**

### **Fr√©quence recommand√©e**

- **D√©veloppement :** Toutes les heures
- **Production :** Toutes les 6 heures
- **Trafic √©lev√© :** Toutes les 2 heures

### **Monitoring avanc√©**

Ajoutez des m√©triques personnalis√©es :

```typescript
// Dans promotion.actions.ts
console.log(`üìä M√©triques: ${expiredPromotions.length} expir√©es, ${Date.now() - startTime}ms`)
```

---

## üéØ **Prochaines √âtapes**

- [ ] **Planification avanc√©e** : Promotions r√©currentes
- [ ] **A/B Testing** : Comparaison de performances
- [ ] **Notifications** : Alertes par email pour les promotions expir√©es
- [ **Analytics** : Suivi d√©taill√© des performances par promotion

---

*Derni√®re mise √† jour : $(date)*
